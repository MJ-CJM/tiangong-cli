# Agents ç³»ç»Ÿæ¶æ„è®¾è®¡

> **ç‰ˆæœ¬**: 2.0 | **æœ€åæ›´æ–°**: 2025-10-07

---

## è®¾è®¡ç›®æ ‡

ä¸º Gemini CLI æ·»åŠ å¤š Agent ç³»ç»Ÿï¼Œå®ç°ï¼š

1. **ä¸“ä¸šåŒ–åˆ†å·¥** - ä¸åŒ Agent ä¸“æ³¨ä¸åŒä»»åŠ¡
2. **ç‹¬ç«‹ä¸Šä¸‹æ–‡** - é¿å…ä¸Šä¸‹æ–‡æ··ä¹±
3. **å·¥å…·éš”ç¦»** - åŸºäºæœ€å°æƒé™åŸåˆ™
4. **MCP é›†æˆ** - æ”¯æŒå¤–éƒ¨å·¥å…·æœåŠ¡å™¨
5. **æ˜“ç”¨æ€§** - ç®€å•çš„åˆ›å»ºå’Œä½¿ç”¨æµç¨‹

---

## æ ¸å¿ƒæ¶æ„

### ç»„ä»¶å…³ç³»å›¾

\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          CLI Layer (Ink/React)          â”‚
â”‚  - agentsCommand.ts                     â”‚
â”‚  - AgentCreationWizard.tsx              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Core Layer                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚     AgentExecutor              â”‚    â”‚
â”‚  â”‚  - execute()                   â”‚    â”‚
â”‚  â”‚  - buildRuntime()              â”‚    â”‚
â”‚  â”‚  - filterMCPTools()            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚           â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    â”‚             â”‚  â”‚
â”‚  â”‚ AgentManager       â”‚ ContextMgr  â”‚  â”‚
â”‚  â”‚ - loadAgents()     â”‚ - getCtx()  â”‚  â”‚
â”‚  â”‚ - getAgent()       â”‚ - addMsg()  â”‚  â”‚
â”‚  â”‚                    â”‚             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚       ToolFilter                 â”‚  â”‚
â”‚  â”‚  - filterTools()                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚       MCPRegistry                â”‚  â”‚
â”‚  â”‚  - getServersForAgent()          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Tool Layer                       â”‚
â”‚  - ToolRegistry                         â”‚
â”‚  - McpClientManager                     â”‚
â”‚  - DiscoveredMCPTool                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

---

## Agent å®šä¹‰æ ¼å¼

### æ–‡ä»¶ç»“æ„

\`\`\`markdown
---
kind: agent
name: code-imple
title: Code Implementation
description: Specialized in code implementation
model: qwen3-coder-flash
scope: project
version: 1.0.0
contextMode: isolated

tools:
  allow: [
    "read_file",
    "write_file",
    "bash",
    "context7__get-library-docs"
  ]
  deny: []

mcp:
  servers: ["context7"]
---

# Role

You are a code implementation specialist...

## Responsibilities

- Translate requirements to code
- Follow best practices
...
\`\`\`

### å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|------|------|------|------|
| kind | string | âœ… | å›ºå®šä¸º "agent" |
| name | string | âœ… | Agent å”¯ä¸€æ ‡è¯† |
| title | string | âšª | æ˜¾ç¤ºåç§° |
| description | string | âšª | ç®€çŸ­æè¿° |
| model | string | âšª | AI æ¨¡å‹ |
| scope | enum | âšª | project/global |
| version | string | âšª | ç‰ˆæœ¬å· |
| contextMode | enum | âšª | isolated/shared |
| tools.allow | array | âšª | ç™½åå•å·¥å…· |
| tools.deny | array | âšª | é»‘åå•å·¥å…· |
| mcp.servers | array | âšª | MCP æœåŠ¡å™¨ |

---

## æ ¸å¿ƒæµç¨‹

### Agent æ‰§è¡Œæµç¨‹

\`\`\`
1. User calls agent
   â†“
2. AgentExecutor.execute()
   â”œâ”€ buildRuntime()
   â”‚  â”œâ”€ è·å–æ‰€æœ‰å·¥å…·
   â”‚  â”œâ”€ è¿‡æ»¤ MCP å·¥å…· (æŒ‰ mcp.servers)
   â”‚  â”œâ”€ è¿‡æ»¤å·¥å…· (æŒ‰ allow/deny)
   â”‚  â””â”€ è¿”å› filtered tools
   â”œâ”€ è·å–/åˆ›å»ºä¸Šä¸‹æ–‡ (isolated/shared)
   â””â”€ å·¥å…·è°ƒç”¨å¾ªç¯
      â”œâ”€ å‘é€æ¶ˆæ¯ç»™æ¨¡å‹
      â”œâ”€ æ¨¡å‹è¿”å›å·¥å…·è°ƒç”¨æˆ–æ–‡æœ¬
      â”œâ”€ æ‰§è¡Œå·¥å…·
      â””â”€ ç»§ç»­å¾ªç¯ç›´åˆ°å®Œæˆ
   â†“
3. è¿”å›æœ€ç»ˆå“åº”
\`\`\`

### å·¥å…·è¿‡æ»¤æµç¨‹

\`\`\`
All Tools (from ToolRegistry)
  â†“
[MCP Server Filter]
  - If agent.mcp.servers: ["context7"]
  - Keep: context7__* tools
  - Remove: github__*, slack__* tools
  â†“
[Allow/Deny Filter]
  - If tools.allow specified
  - Keep only tools in allow list
  - Remove tools in deny list
  â†“
Final Tool List (passed to model)
\`\`\`

---

## å…³é”®è®¾è®¡å†³ç­–

### 1. æ–‡ä»¶å¼å®šä¹‰

**å†³ç­–**: ä½¿ç”¨ Markdown + YAML æ–‡ä»¶å®šä¹‰ Agent

**åŸå› **:
- âœ… ç‰ˆæœ¬æ§åˆ¶å‹å¥½
- âœ… æ˜“äºç¼–è¾‘å’Œå®¡æŸ¥
- âœ… æ”¯æŒå¯Œæ–‡æœ¬ç³»ç»Ÿæç¤ºè¯
- âœ… è·¨é¡¹ç›®å…±äº«æ–¹ä¾¿

### 2. ä¸¤çº§å·¥å…·è¿‡æ»¤

**å†³ç­–**: MCP æœåŠ¡å™¨çº§ + å·¥å…·çº§åŒé‡è¿‡æ»¤

**åŸå› **:
- âœ… æœ€å°æƒé™åŸåˆ™
- âœ… æœåŠ¡å™¨çº§æ§åˆ¶ï¼ˆç²—ç²’åº¦ï¼‰
- âœ… å·¥å…·çº§æ§åˆ¶ï¼ˆç»†ç²’åº¦ï¼‰
- âœ… Defense in depth

### 3. é»˜è®¤ Isolated ä¸Šä¸‹æ–‡

**å†³ç­–**: é»˜è®¤ä½¿ç”¨ isolated æ¨¡å¼

**åŸå› **:
- âœ… å®‰å…¨æ€§ä¼˜å…ˆ
- âœ… é¿å…æ„å¤–æ³„éœ²
- âœ… æ¸…æ™°çš„ä»»åŠ¡è¾¹ç•Œ
- âœ… éœ€è¦æ—¶å¯æ˜¾å¼æŒ‡å®š shared

### 4. ä¿¡ä»»æ–‡ä»¶å¤¹æœºåˆ¶

**å†³ç­–**: MCP å·¥å…·ä»…åœ¨ä¿¡ä»»æ–‡ä»¶å¤¹ä¸­å¯ç”¨

**åŸå› **:
- âœ… å®‰å…¨æ€§ï¼ˆé˜²æ­¢æ¶æ„é¡¹ç›®ï¼‰
- âœ… ç”¨æˆ·åŒæ„ï¼ˆæ˜¾å¼æˆæƒï¼‰
- âœ… ç¬¦åˆå®‰å…¨æœ€ä½³å®è·µ

---

## æŠ€æœ¯çº¦æŸ

### æ€§èƒ½è¦æ±‚

- Agent åˆ‡æ¢å»¶è¿Ÿ < 100ms âœ…
- å·¥å…·è¿‡æ»¤å¼€é”€ < 10ms âœ…
- ä¸Šä¸‹æ–‡éš”ç¦»æ— æ³„æ¼ âœ…

### å…¼å®¹æ€§

- æ”¯æŒå¤šç§ AI æ¨¡å‹ âœ…
- æ”¯æŒ MCP åè®®æ ‡å‡† âœ…
- ä¸ç°æœ‰å·¥å…·ç³»ç»Ÿå…¼å®¹ âœ…

---

## æ‰©å±•æ€§

### å½“å‰æ”¯æŒ

- âœ… è‡ªå®šä¹‰ Agent å®šä¹‰
- âœ… é¡¹ç›®çº§å’Œå…¨å±€çº§ Agent
- âœ… MCP å·¥å…·é›†æˆ
- âœ… AI å†…å®¹ç”Ÿæˆ
- âœ… äº¤äº’å¼åˆ›å»º

### æœªæ¥æ‰©å±•

- ğŸ”„ è‡ªåŠ¨è·¯ç”±ï¼ˆåŸºäº triggersï¼‰
- ğŸ”„ Agent é—´ç§»äº¤ï¼ˆhandoffsï¼‰
- ğŸ”„ è¾“å‡ºæ ¡éªŒï¼ˆguardrailsï¼‰
- ğŸ”„ çŠ¶æ€è®°å¿†ï¼ˆmemoryï¼‰
- ğŸ”„ å›¾ç¼–æ’ï¼ˆworkflowï¼‰
- ğŸ”„ å¯è§‚æµ‹æ€§ï¼ˆtracingï¼‰

è¯¦è§ [ROADMAP.md](./ROADMAP.md)

---

**æ–‡æ¡£ç‰ˆæœ¬**: 2.0 (æ•´åˆç‰ˆ)
**åˆ›å»ºæ—¥æœŸ**: 2025-10-04
**æœ€åæ›´æ–°**: 2025-10-07

è¯¦ç»†å®ç°è¯·å‚è€ƒï¼š
- [IMPLEMENTATION.md](./IMPLEMENTATION.md) - å®ç°ç»†èŠ‚
- [CONTEXT_MODE.md](./CONTEXT_MODE.md) - ä¸Šä¸‹æ–‡æ¨¡å¼
- [MCP_INTEGRATION.md](./MCP_INTEGRATION.md) - MCP é›†æˆ
