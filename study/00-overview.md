# 00 - é¡¹ç›®æ¦‚è§ˆ

**é€‚ç”¨ç‰ˆæœ¬**: `0.6.0-nightly`
**Commit Hash**: `b347fa25e9133d410c4210e3825ace0cae5b4ecb` (2025-09-28)
**æ–‡æ¡£æ—¥æœŸ**: 2025-10-01

---

## ğŸ“Œ é¡¹ç›®èƒŒæ™¯

**Gemini CLI** æ˜¯ Google å®˜æ–¹å¼€å‘çš„åŸºäº Gemini API çš„å‘½ä»¤è¡Œæ™ºèƒ½åŠ©æ‰‹ï¼Œæ—¨åœ¨æä¾›ï¼š

- **äº¤äº’å¼ AI å¯¹è¯**ï¼šåœ¨ç»ˆç«¯ä¸­ä¸ Gemini æ¨¡å‹è¿›è¡Œæµå¼å¯¹è¯
- **ä»£ç è¾…åŠ©**ï¼šé€šè¿‡å·¥å…·ï¼ˆToolsï¼‰è°ƒç”¨å®ç°æ–‡ä»¶è¯»å†™ã€ä»£ç æœç´¢ã€Shell æ‰§è¡Œç­‰
- **å¯æ‰©å±•æ¶æ„**ï¼šæ”¯æŒè‡ªå®šä¹‰ Slash å‘½ä»¤ã€MCP æœåŠ¡å™¨ã€å·¥å…·æ’ä»¶

### æ ¸å¿ƒèƒ½åŠ›çŸ©é˜µ

| èƒ½åŠ›åŸŸ | æ ¸å¿ƒåŠŸèƒ½ | æŠ€æœ¯å®ç° |
|-------|---------|---------|
| **å¯¹è¯** | æµå¼/éæµå¼å“åº”ã€ä¸Šä¸‹æ–‡ç®¡ç†ã€ä¼šè¯å‹ç¼© | Gemini API + é‡è¯•/é€€é¿ |
| **å·¥å…·** | 13 ä¸ªå†…ç½®å·¥å…·ï¼ˆæ–‡ä»¶ã€æœç´¢ã€æ‰§è¡Œã€ç½‘ç»œï¼‰ | Function Calling |
| **å‘½ä»¤** | å¯æ’æ‹” Slash å‘½ä»¤ç³»ç»Ÿï¼ˆ`/help`, `/tools` ç­‰ï¼‰ | è‡ªå®šä¹‰ CommandService |
| **é…ç½®** | å¤šå±‚çº§é…ç½®ï¼ˆç³»ç»Ÿ/ç”¨æˆ·/é¡¹ç›®/ç¯å¢ƒå˜é‡ï¼‰ | Zod æ ¡éªŒ + Hierarchical Loading |
| **æ‰©å±•** | MCP æœåŠ¡å™¨ã€è‡ªå®šä¹‰å·¥å…·ã€å‘½ä»¤æ’ä»¶ | Provider-Loader æ¨¡å¼ |
| **å®‰å…¨** | æ²™ç®±æ‰§è¡Œï¼ˆmacOS/Dockerï¼‰ã€æƒé™ç¡®è®¤ | Seatbelt/Container |

---

## ğŸ¯ å…¸å‹äº¤äº’æµç¨‹

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·ç»ˆç«¯
    participant CLI as CLI Layer<br/>(React/Ink)
    participant Core as Core Layer<br/>(Business Logic)
    participant Gemini as Gemini API
    participant Tools as Tool System

    User->>CLI: è¾“å…¥ Prompt æˆ– /command
    CLI->>CLI: è§£æè¾“å…¥ï¼ˆå‘½ä»¤ vs å¯¹è¯ï¼‰

    alt Slash Command
        CLI->>CLI: CommandService åˆ†å‘
        CLI->>Core: æ‰§è¡Œå‘½ä»¤é€»è¾‘ï¼ˆå¦‚ /settingsï¼‰
        Core-->>CLI: è¿”å›å‘½ä»¤ç»“æœ
    else æ™®é€šå¯¹è¯
        CLI->>Core: æ„é€ è¯·æ±‚ä¸Šä¸‹æ–‡
        Core->>Core: åŠ è½½å†å²ã€é…ç½®ã€å·¥å…·åˆ—è¡¨
        Core->>Gemini: å‘é€è¯·æ±‚ï¼ˆgenerateContentï¼‰

        alt æ¨¡å‹è¿”å›å·¥å…·è°ƒç”¨
            Gemini-->>Core: FunctionCall Parts
            Core->>Tools: æ‰§è¡Œå·¥å…·ï¼ˆå¦‚ read_fileï¼‰
            Tools-->>Core: å·¥å…·ç»“æœ
            Core->>Core: æ„é€  FunctionResponse
            Core->>Gemini: å‘é€å·¥å…·ç»“æœ
            Gemini-->>Core: æœ€ç»ˆæ–‡æœ¬å“åº”
        else çº¯æ–‡æœ¬å“åº”
            Gemini-->>Core: æ–‡æœ¬ Parts
        end

        Core-->>CLI: æµå¼ Chunk / å®Œæ•´å“åº”
        CLI-->>User: æ¸²æŸ“è¾“å‡ºï¼ˆMarkdown/Table/Diffï¼‰
    end
```

---

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

### åˆ†å±‚è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç»ˆç«¯ç”¨æˆ· (stdin/stdout/stderr)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLI Package (packages/cli/)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ React/Ink TUI (gemini.tsx)                         â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ â€¢ å‘½ä»¤åˆ†å‘ (CommandService)                        â”‚  â”‚
â”‚  â”‚ â€¢ UI ç»„ä»¶ (AppContainer, MessageList, Input)       â”‚  â”‚
â”‚  â”‚ â€¢ çŠ¶æ€ç®¡ç† (Context: Settings, Session, Vim)       â”‚  â”‚
â”‚  â”‚ â€¢ é”®ç›˜å¤„ç† (Hooks: useKeypress, useCompletion)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Core Package (packages/core/)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ä¸šåŠ¡é€»è¾‘å±‚                                          â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ â€¢ geminiChat.ts (ä¸»å¯¹è¯å¾ªç¯)                       â”‚  â”‚
â”‚  â”‚ â€¢ ToolRegistry (å·¥å…·æ³¨å†Œä¸æ‰§è¡Œ)                    â”‚  â”‚
â”‚  â”‚ â€¢ Config (é…ç½®ç®¡ç†)                                â”‚  â”‚
â”‚  â”‚ â€¢ Services (Git, Shell, FileSystem)               â”‚  â”‚
â”‚  â”‚ â€¢ Routing (ModelRouterService - å¤šæ¨¡å‹æ”¯æŒ)        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  External APIs & Systems                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Gemini API      â”‚  â”‚ MCP Servers     â”‚  â”‚ Shell    â”‚ â”‚
â”‚  â”‚ (@google/genai) â”‚  â”‚ (MCP SDK)       â”‚  â”‚ (spawn)  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®æ•°æ®æµ

#### 1. é…ç½®åŠ è½½æµç¨‹
```
å¯åŠ¨ â†’ parseArguments (CLI args)
     â†’ loadSettings (User/Project/System)
     â†’ Environment Variables (.env)
     â†’ Config å¯¹è±¡åˆå§‹åŒ–
     â†’ ToolRegistry.discoverAllTools()
```

#### 2. å¯¹è¯è¯·æ±‚æµç¨‹
```
ç”¨æˆ·è¾“å…¥ â†’ readStdin / UI Input
        â†’ geminiChat.sendMessage()
        â†’ retryWithBackoff(generateContent)
        â†’ æµå¼å¤„ç† (async generator)
        â†’ å·¥å…·è°ƒç”¨æ£€æµ‹ (functionCall parts)
        â†’ ToolRegistry.getTool().execute()
        â†’ æ„é€  FunctionResponse
        â†’ é‡æ–°è°ƒç”¨æ¨¡å‹ï¼ˆå¸¦å·¥å…·ç»“æœï¼‰
        â†’ æœ€ç»ˆå“åº” â†’ UI æ¸²æŸ“
```

---

## ğŸ”‘ æ ¸å¿ƒæ¦‚å¿µ

### 1. Slash Commands
- **å®šä¹‰**: ä»¥ `/` å¼€å¤´çš„ç‰¹æ®ŠæŒ‡ä»¤ï¼ˆå¦‚ `/help`, `/quit`ï¼‰
- **å®ç°**: `CommandService` + `ICommandLoader` æ¥å£
- **æ‰©å±•**: é€šè¿‡ Extension ç³»ç»Ÿæˆ–è‡ªå®šä¹‰ Loader æ·»åŠ æ–°å‘½ä»¤

### 2. Tools (Function Calling)
- **å®šä¹‰**: AI å¯è°ƒç”¨çš„å‡½æ•°ï¼ˆå¦‚ `read_file`, `run_shell`ï¼‰
- **å®ç°**: åŸºäº Gemini API çš„ Function Calling æœºåˆ¶
- **å†…ç½®**: 13 ä¸ªå·¥å…·ï¼ˆè§è¯¦ç»†åˆ—è¡¨ï¼‰
- **æ‰©å±•**: ç»§æ‰¿ `DeclarativeTool` æˆ–é€šè¿‡ MCP æœåŠ¡å™¨

### 3. MCP (Model Context Protocol)
- **å®šä¹‰**: è·¨å¹³å°çš„ AI å·¥å…·åè®®æ ‡å‡†
- **ä½œç”¨**: å…è®¸å¤–éƒ¨æœåŠ¡æä¾›å·¥å…·/ä¸Šä¸‹æ–‡ç»™ CLI
- **é…ç½®**: `settings.json` ä¸­çš„ `mcpServers` å­—æ®µ

### 4. Config Hierarchy
```
ç³»ç»Ÿé»˜è®¤å€¼ (hardcoded)
  â†“
ç³»ç»Ÿé…ç½® (~/.gemini/settings.json)
  â†“
ç”¨æˆ·é…ç½® (~/.gemini/settings.json)
  â†“
é¡¹ç›®é…ç½® (.gemini/settings.json)
  â†“
ç¯å¢ƒå˜é‡ (.env)
  â†“
CLI å‚æ•° (--flag)
```

---

## ğŸ“Š èƒ½åŠ›è¾¹ç•Œä¸é™åˆ¶

### âœ… å½“å‰æ”¯æŒ
- [x] Gemini 1.5 Pro/Flash æ¨¡å‹
- [x] æµå¼/éæµå¼å“åº”
- [x] 13 ä¸ªå†…ç½®å·¥å…·
- [x] MCP æœåŠ¡å™¨é›†æˆ
- [x] é…ç½®åˆ†å±‚ç®¡ç†
- [x] OAuth/API Key/ADC è®¤è¯
- [x] macOS/Docker æ²™ç®±
- [x] Vim æ¨¡å¼ã€å†å²è®°å½•

### âŒ å½“å‰é™åˆ¶
- [ ] å¤šæ¨¡å‹ Providerï¼ˆOpenAI/Claudeï¼‰**æœªå®Œå…¨å¯ç”¨**
- [ ] å·¥å…·è¾“å‡ºè¶…é•¿æ—¶çš„æ™ºèƒ½æˆªæ–­ï¼ˆå·²æœ‰ä½†å¯ä¼˜åŒ–ï¼‰
- [ ] è·¨ä¼šè¯ä¸Šä¸‹æ–‡æŒä¹…åŒ–ï¼ˆä»…æ”¯æŒå•ä¼šè¯ï¼‰
- [ ] æ›´ç»†ç²’åº¦çš„å·¥å…·æƒé™æ§åˆ¶
- [ ] Windows æ²™ç®±æ”¯æŒï¼ˆä»… Docker/Podmanï¼‰

### ğŸš§ å®éªŒæ€§åŠŸèƒ½
- `useSmartEdit`: LLM è¾…åŠ©ä¿®å¤ç¼–è¾‘é”™è¯¯
- `ModelRouterService`: å¤šæ¨¡å‹è·¯ç”±ï¼ˆä»£ç å­˜åœ¨ä½†æœªé»˜è®¤å¯ç”¨ï¼‰
- `A2A Server`: Agent-to-Agent é€šä¿¡æœåŠ¡å™¨

---

## ğŸ¬ å¿«é€Ÿå¼€å§‹

### æœ€å°å¯åŠ¨
```bash
# å®‰è£…ä¾èµ–
npm install

# æ„å»º
npm run build

# è¿è¡Œï¼ˆéœ€è¦ GEMINI_API_KEYï¼‰
export GEMINI_API_KEY="your_api_key"
npm start
```

### å…¸å‹ä½¿ç”¨åœºæ™¯
```bash
# 1. ä»£ç é—®ç­”
$ gemini
> è§£é‡Šè¿™æ®µä»£ç çš„ä½œç”¨
[AI é€šè¿‡ read_file å·¥å…·è¯»å–æ–‡ä»¶å¹¶è§£é‡Š]

# 2. æ‰§è¡Œå‘½ä»¤
> åˆ—å‡ºå½“å‰ç›®å½•ä¸‹çš„ TypeScript æ–‡ä»¶
[AI è°ƒç”¨ run_shell å·¥å…·æ‰§è¡Œ ls *.ts]

# 3. Slash å‘½ä»¤
> /settings
[æ˜¾ç¤ºå½“å‰é…ç½®]
```

---

## ğŸ“š åç»­æ–‡æ¡£å¯¼èˆª

| æ–‡æ¡£ | ä¸»é¢˜ |
|------|------|
| [01-architecture.md](./01-architecture.md) | è¯¦ç»†æ¶æ„ä¸æ¨¡å—åˆ†æ |
| [02-commands.md](./02-commands.md) | å‘½ä»¤ç³»ç»Ÿä¸æ–°å¢æ¨¡æ¿ |
| [03-config-and-secrets.md](./03-config-and-secrets.md) | é…ç½®ç®¡ç†ä¸å¯†é’¥å®‰å…¨ |
| [04-model-and-providers.md](./04-model-and-providers.md) | æ¨¡å‹å±‚ä¸å¤š Provider è®¾è®¡ |
| [05-extensibility.md](./05-extensibility.md) | æ‰©å±•ç‚¹ä¸æ’ä»¶å¼€å‘ |
| [06-dev-setup.md](./06-dev-setup.md) | å¼€å‘ç¯å¢ƒä¸å·¥å…·é“¾ |
| [07-testing-and-ci.md](./07-testing-and-ci.md) | æµ‹è¯•ç­–ç•¥ä¸ CI é…ç½® |
| [08-roadmap.md](./08-roadmap.md) | æ¼”è¿›è·¯çº¿å›¾ä¸é£é™© |

---

**ä¸‹ä¸€æ­¥**: é˜…è¯» [01-architecture.md](./01-architecture.md) äº†è§£è¯¦ç»†æ¶æ„è®¾è®¡ã€‚
